<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <title>AJAX Test</title>
    <script src="../target/index.js"></script>
  </head>
  <body>
    <button name="launch">Launch the missiles</button>
    <p class="message"></p>
  </body>
  <script>
    var button = document.querySelector("button");
    var message = document.querySelector(".message");
    function launchMissiles() {
        return new Promise((resolve, reject) => {
            setTimeout(() => {
                Math.random() < 0.5 ? resolve() : reject();
            }, (Math.random() * 250) + 750);
        });
    }
    button.addEventListener("click", function () {
        //setTimeout(function () {
            button.disabled = true;
        //}, 100);
        message.innerText = "Missiles launched.";
        launchMissiles().then(() => {
            message.innerText = "Boom!";
        }).catch(() => {
            message.innerText = "Missiles did not hit target.";
        });
    });
  </script>
  <script>
    const spec = {
      queries: [
        wtp.enabled(wtp.byCss("button[name=launch]")),
        wtp.text(wtp.byCss(".message")),
      ],
      actions: [wtp.click("button")],
      maxActions: 10,
      actionTimeout: 500,
    };
    /*
    wtp.check();
    */
    /*
    (async function() {
        while (true) {
            const observer = wtp.registerNextNonStutterStateObserver(wtp.observeInitialStates(spec.queries), spec.queries);
            const action = wtp.selectNextAction(spec.actions);
            if (action) {
                await wtp.runAction(action);
            } else {
                console.log("No more actions.");
            }
            console.log(await wtp.getNextNonStutterState(observer));
        }
    })();
    */
    console.log(JSON.stringify(wtp.mapToArray(wtp.observeInitialStates(spec.queries))));
  </script>
</html>
